# Vulnerability dashboard

a [Sails v1](https://sailsjs.com) application


### Getting started

1. Fork this repo
2. Deploy the app
3. Add required configuration variables:
    - `sails.config.custom.fleetBaseUrl` - The base URL of your Fleet instance. (e.g., `https://fleet.example.com`)
    - `sails.config.custom.fleetApiToken` - The API token of a Fleet API-only user for your Fleet instance.
    
    These variables can be added to `config/custom.js`, provided as environment variables (`sails_custom__fleetBaseUrl` & `sails_custom__fleetApiToken`) or be passed in with CLI flags when starting the server e.g.,`sails_custom__fleetBaseUrl=https://fleet.example.com sails_custom_fleetApiToken=foo sails lift`
   
4. Schedule an hourly cron job to run the `update-reports` script.
    
    
##### Things you won't need:
- You will only need one compute instance, so you can get away without Redis this time if you want.  (But setting up Redis will mean you won't get randomly logged out, which is nice.)


### Deployment
You can deploy this app however/wherever you want for your own uses.
For convenience, this repo also includes a built-in way on top of Heroku that's handy if you're working on the underlying source code.
1. Set GitHub Secrets:
  - _you can set these in "Settings > Secrets" in the GitHub UI, as of like April 2023.  They'll probably change it at some point but, you've got this!  They're lurking in the UI somewhere._
  - `HEROKU_API_TOKEN_FOR_DEPLOYMENT` (your heroku api token)
  - `HEROKU_EMAIL_FOR_DEPLOYMENT` (your heroku login email)
  - `HEROKU_APP_NAME` (your heroku application's name)
2. Create a heroku app, set up a database, add redis and Papertrail too, if you can be bothered.  (If you're using a SQL database, use a wipe script to set up the tables- e.g. set database url in `package.json` and then `sails run wipe`
3. Optional: `npm install` your database adapter and configure it in config/env/production.js.
4. Configure the app to know its own URL in the production config (`baseUrl` and `sockets.onlyAllowOrigins`).  Note that other settings necessary for Heroku (secure cookies and trust proxy config) are already enabled.
6. Customize the github action in this repo to point at your repo (it has a failsafe at the top to prevent deploying on every 3rd party PR)
7. Push something to master and it will deploy.
8. Once it's working, login with `admin@example.com`/`abc123` and then change your password.

