# syntax=docker/dockerfile:1

FROM node:18-alpine
RUN apk update && apk upgrade
RUN apk add redis
RUN npm install -g npm@9.6.5
WORKDIR .
COPY . .
RUN npm install sails -g
RUN npm install
RUN npm run build-for-prod
RUN rm -rf node_modules/
RUN npm install --omit=dev
CMD sails lift --prod
EXPOSE 1337